<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>银行后台模拟系统</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        input, select { margin: 5px; padding: 8px; width: 200px; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        #dashboard, #account-menu, #transaction-menu, #limits, #contacts, #transactions, #history, #account-info { display: none; }
        table { width: 80%; margin: 10px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
    </style>
</head>
<body>

    <h2>银行后台模拟系统</h2>

    <div id="login">
        <label>用户名: <input id="username" type="text"></label><br>
        <label>密码: <input id="password" type="password"></label><br>
        <button onclick="login()">登录</button>
        <button onclick="register()">注册</button>
        <p id="login-message" style="color: red;"></p>
    </div>

    <div id="dashboard">
        <h3>欢迎, <span id="user"></span></h3>
        <button onclick="toggleMenu('account-menu')">账户</button>
        <button onclick="toggleMenu('transaction-menu')">交易</button>
        <button onclick="toggleMenu('limits')">限额设置</button>
        <button onclick="logout()">退出</button>
    </div>

    <!-- 账户管理菜单 -->
    <div id="account-menu">
        <h3>账户管理</h3>
        <button onclick="showAccountInfo()">账户信息</button>
        <button onclick="showContacts()">联系人</button>
        <button onclick="addContact()">添加联系人</button>
        <button onclick="changePassword()">修改密码</button>
        <button onclick="lockAccount()">锁定账户</button>
        <button onclick="deleteAccount()">注销账户</button>
    </div>

    <!-- 账户信息 -->
    <div id="account-info">
        <h3>账户信息</h3>
        <p>用户名: <span id="account-username"></span></p>
        <p>银行卡号: <span id="account-card"></span></p>
        <p>账户余额: <span id="account-balance"></span> 元</p>
    </div>

    <!-- 交易管理菜单 -->
    <div id="transaction-menu">
        <h3>交易管理</h3>
        <button onclick="showTransactionPanel()">转账</button>
        <button onclick="showTransactionHistory('day')">日账单</button>
        <button onclick="showTransactionHistory('month')">月账单</button>
        <button onclick="showTransactionHistory('year')">年账单</button>
    </div>

    <!-- 交易记录 -->
    <div id="history">
        <h3>交易记录</h3>
        <table>
            <thead>
                <tr>
                    <th>交易时间</th>
                    <th>类型</th>
                    <th>金额</th>
                </tr>
            </thead>
            <tbody id="history-table"></tbody>
        </table>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem("users")) || { "admin": "admin123" };
        let transactions = JSON.parse(localStorage.getItem("transactions")) || {};
        let balances = JSON.parse(localStorage.getItem("balances")) || {};
        let cardNumbers = JSON.parse(localStorage.getItem("cardNumbers")) || {};

        function generateRandomCard() {
            return Math.floor(1000000000000000 + Math.random() * 9000000000000000).toString();
        }

        function generateRandomTransactions(username) {
            transactions[username] = [];
            let types = ["收入", "支出"];
            for (let i = 0; i < 20; i++) {
                let amount = Math.floor(Math.random() * 5000) + 100;
                let type = types[Math.floor(Math.random() * 2)];
                let date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 365)); // 过去一年内随机日期
                transactions[username].push({ date: date.toISOString().split("T")[0], type, amount });
            }
            localStorage.setItem("transactions", JSON.stringify(transactions));
        }

        function login() {
            let username = document.getElementById("username").value.trim();
            let password = document.getElementById("password").value.trim();

            if (users[username] && users[username] === password) {
                document.getElementById("login").style.display = "none";
                document.getElementById("dashboard").style.display = "block";
                document.getElementById("user").innerText = username;

                if (!balances[username]) {
                    balances[username] = Math.floor(Math.random() * 90000) + 1000; // 1000~100000
                    localStorage.setItem("balances", JSON.stringify(balances));
                }

                if (!cardNumbers[username]) {
                    cardNumbers[username] = generateRandomCard();
                    localStorage.setItem("cardNumbers", JSON.stringify(cardNumbers));
                }

                if (!transactions[username]) {
                    generateRandomTransactions(username);
                }
            } else {
                document.getElementById("login-message").innerText = "登录失败，用户名或密码错误！";
            }
        }

        function showAccountInfo() {
            let username = document.getElementById("user").innerText;
            document.getElementById("account-username").innerText = username;
            document.getElementById("account-card").innerText = cardNumbers[username];
            document.getElementById("account-balance").innerText = balances[username];
            document.getElementById("account-info").style.display = "block";
        }

        function showTransactionHistory(period) {
            let username = document.getElementById("user").innerText;
            let historyTable = document.getElementById("history-table");
            historyTable.innerHTML = "";

            let now = new Date();
            let filteredTransactions = transactions[username].filter(txn => {
                let txnDate = new Date(txn.date);
                if (period === "day") {
                    return txnDate.toDateString() === now.toDateString();
                } else if (period === "month") {
                    return txnDate.getMonth() === now.getMonth() && txnDate.getFullYear() === now.getFullYear();
                } else if (period === "year") {
                    return txnDate.getFullYear() === now.getFullYear();
                }
                return false;
            });

            filteredTransactions.forEach(txn => {
                let row = `<tr><td>${txn.date}</td><td>${txn.type}</td><td>${txn.amount} 元</td></tr>`;
                historyTable.innerHTML += row;
            });

            document.getElementById("history").style.display = "block";
        }

        function logout() {
            document.getElementById("dashboard").style.display = "none";
            document.getElementById("login").style.display = "block";
        }
    </script>

</body>
</html>
