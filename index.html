<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>银行后台模拟系统</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        input { margin: 5px; padding: 8px; width: 200px; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        #dashboard, #transactions, #history { display: none; }
        table { width: 80%; margin: 10px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
    </style>
</head>
<body>

    <h2>银行后台模拟系统</h2>

    <div id="login">
        <label>用户名: <input id="username" type="text"></label><br>
        <label>密码: <input id="password" type="password"></label><br>
        <button onclick="login()">登录</button>
        <button onclick="register()">注册</button>
        <p id="login-message" style="color: red;"></p>
    </div>

    <div id="dashboard">
        <h3>欢迎, <span id="user"></span></h3>
        <button onclick="showTransactionPanel()">转账</button>
        <button onclick="showTransactionHistory()">查看交易记录</button>
        <button onclick="changePassword()">修改密码</button>
        <button onclick="lockAccount()">锁定账户</button>
        <button onclick="deleteAccount()">注销账户</button>
        <button onclick="logout()">退出</button>
    </div>

    <div id="transactions">
        <h3>转账系统</h3>
        <label>收款人: <input id="recipient" type="text"></label><br>
        <label>转账金额: <input id="amount" type="number"></label><br>
        <button onclick="makeTransaction()">提交转账</button>
        <p id="transaction-message"></p>
    </div>

    <div id="history">
        <h3>交易记录</h3>
        <table>
            <thead>
                <tr>
                    <th>转账人</th>
                    <th>收款人</th>
                    <th>金额</th>
                    <th>时间</th>
                </tr>
            </thead>
            <tbody id="history-table"></tbody>
        </table>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem("users")) || { "admin": "admin123" };
        let lockedAccounts = JSON.parse(localStorage.getItem("lockedAccounts")) || [];
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

        function login() {
            let username = document.getElementById("username").value.trim();
            let password = document.getElementById("password").value.trim();
            
            if (lockedAccounts.includes(username)) {
                document.getElementById("login-message").innerText = "账户已锁定，无法登录！";
                return;
            }

            if (users[username] && users[username] === password) {
                document.getElementById("login").style.display = "none";
                document.getElementById("dashboard").style.display = "block";
                document.getElementById("user").innerText = username;
                document.getElementById("login-message").innerText = "";
            } else {
                document.getElementById("login-message").innerText = "登录失败，用户名或密码错误！";
            }
        }

        function register() {
            let newUsername = prompt("请输入新用户名:");
            let newPassword = prompt("请输入密码:");

            if (!newUsername || !newPassword) {
                alert("用户名或密码不能为空！");
                return;
            }

            if (users[newUsername]) {
                alert("用户名已存在，请换一个！");
                return;
            }

            users[newUsername] = newPassword;
            localStorage.setItem("users", JSON.stringify(users));
            alert("注册成功！请使用新账号登录。");
        }

        function showTransactionPanel() {
            document.getElementById("transactions").style.display = "block";
            document.getElementById("history").style.display = "none";
        }

        function makeTransaction() {
            let sender = document.getElementById("user").innerText;
            let recipient = document.getElementById("recipient").value.trim();
            let amount = parseFloat(document.getElementById("amount").value);

            if (!users[recipient]) {
                document.getElementById("transaction-message").innerText = "收款人不存在！";
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                document.getElementById("transaction-message").innerText = "请输入有效的交易金额！";
                return;
            }

            if (amount > 10000) {
                document.getElementById("transaction-message").innerText = "交易失败：超过最大交易限制（10000元）！";
                return;
            }

            let transaction = { sender, recipient, amount, timestamp: new Date().toLocaleString() };
            transactions.push(transaction);
            localStorage.setItem("transactions", JSON.stringify(transactions));
            document.getElementById("transaction-message").innerText = "交易成功！";
        }

        function showTransactionHistory() {
            document.getElementById("transactions").style.display = "none";
            document.getElementById("history").style.display = "block";
            
            let historyTable = document.getElementById("history-table");
            historyTable.innerHTML = "";

            transactions.forEach(t => {
                let row = `<tr><td>${t.sender}</td><td>${t.recipient}</td><td>${t.amount}</td><td>${t.timestamp}</td></tr>`;
                historyTable.innerHTML += row;
            });
        }

        function changePassword() {
            let username = document.getElementById("user").innerText;
            let newPassword = prompt("请输入新密码:");

            if (!newPassword) {
                alert("密码不能为空！");
                return;
            }

            users[username] = newPassword;
            localStorage.setItem("users", JSON.stringify(users));
            alert("密码修改成功！");
        }

        function lockAccount() {
            let username = document.getElementById("user").innerText;
            lockedAccounts.push(username);
            localStorage.setItem("lockedAccounts", JSON.stringify(lockedAccounts));
            alert("账户已锁定，下次无法登录！");
        }

        function deleteAccount() {
            let username = document.getElementById("user").innerText;
            delete users[username];
            localStorage.setItem("users", JSON.stringify(users));
            alert("账户已注销！");
            logout();
        }

        function logout() {
            document.getElementById("dashboard").style.display = "none";
            document.getElementById("transactions").style.display = "none";
            document.getElementById("history").style.display = "none";
            document.getElementById("login").style.display = "block";
            document.getElementById("login-message").innerText = "";
        }

        // 预设 10 份交易记录
        if (transactions.length === 0) {
            for (let i = 1; i <= 10; i++) {
                transactions.push({
                    sender: "user" + i,
                    recipient: "user" + (i + 1),
                    amount: Math.floor(Math.random() * 5000) + 1,
                    timestamp: new Date().toLocaleString()
                });
            }
            localStorage.setItem("transactions", JSON.stringify(transactions));
        }
    </script>

</body>
</html>
